/*
 *	GetFile v4.2 - 2015-07-09
 *	jQuery Upload Plugin
 *	(c) 2015 Syscover S.L. - http://www.syscover.com/
 *	All rights reserved
 */
"use strict";!function(e){var t={options:{urlPlugin:".",folder:null,tmpFolder:null,srcFolder:null,srcFile:null,encryption:!1,filename:null,outputExtension:null,quality:100,multiple:!1,maxFileSize:!1,maxFilesSizes:!1,activateTmpDelete:!0,spinner:!0,mimesAccept:["image/*","video/*","audio/*","text/plain","application/pdf","application/msword","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],crop:{active:!1,width:null,height:null,quality:100,aspectRatio:null,minSize:0,maxSize:0,setSelect:0},resize:{active:!1,width:null,height:null,quality:75,constrainProportions:!0},copies:[{width:null,height:null,quality:75,constrainProportions:!0,prefix:null,folder:null,outputExtension:null}],lang:{cropWindowTitle:"Crop image",previewTitle:"Preview",cropButtonText:"Crop",cancelButtonText:"Cancel"},selectorItems:{container:"#cropper-modal",cropButton:"#gfCropButton",cancelButton:"#gfCancelButton",crop:".img-container",image:".img-original",preview:".img-preview"}},items:{container:null,cropButton:null,cancelButton:null,crop:null,image:null,preview:null},properties:{files:null,coords:null,tmpDelete:345600,tmpName:"",oldName:null,extension:null,mime:null,size:null,isImage:null,width:null,height:null,pixelRatio:null,src:null,response:null},callback:null,init:function(t,i,s){if(void 0==t.copies)this.options.copies=[];else for(var o=0;o<t.copies.length;o++)t.copies[o]=e.extend({},this.options.copies[0],t.copies[o]||{});if(void 0!=t.crop&&(t.crop=e.extend({},this.options.crop,t.crop||{})),this.options=e.extend({},this.options,t||{}),this.options.crop.active&&0==e(this.options.selectorItems.container).length){var p=this.options.lang;p.urlPlugin=t.urlPlugin,e.ajax({cache:!1,dataType:"html",context:this,type:"POST",url:this.options.urlPlugin+"/getfile/views/popup.php",data:p,success:function(t){e("body").append(t),this.items={container:e(this.options.selectorItems.container),cropButton:e(this.options.selectorItems.cropButton),cancelButton:e(this.options.selectorItems.cancelButton),crop:e(this.options.selectorItems.crop),image:e(this.options.selectorItems.image),preview:e(this.options.selectorItems.preview)},this.items.cancelButton.on("click",function(){e("#cropper-modal").modal("hide")})},error:function(e){var e={success:!1,error:12,message:"The path: "+this.url+" in the ajax request is not correct, please check the ajax function data"};i(e)}})}else this.items={container:e(this.options.selectorItems.container),cropButton:e(this.options.selectorItems.cropButton),cancelButton:e(this.options.selectorItems.cancelButton),crop:e(this.options.selectorItems.crop),image:e(this.options.selectorItems.image),preview:e(this.options.selectorItems.preview)};if(t.mimesAccept&&(this.options.mimesAccept=t.mimesAccept),this.callback=i,null==this.options.srcFolder){if(this.elem=e(s),this.options.multiple)var n={multiple:!0,logging:!1};else var n={logging:!1};if(0==this.options.mimesAccept)window.fd.logging=!1,fd.jQuery(),e(this.elem).filedrop(n).filedrop().event("send",function(t){e.proxy(this.upload(t),this)}.bind(this));else if("[object Array]"===Object.prototype.toString.call(this.options.mimesAccept))window.fd.logging=!1,fd.jQuery(),e(this.elem).filedrop(n).filedrop().event("send",function(t){e.proxy(this.upload(t),this)}.bind(this));else{var r={success:!1,error:11,message:"The mimesAccept setting must be an array or false. Setting it to false might be dangerous, since it means accepting all file types"};null!=this.callback&&this.callback(r)}}else this.loadSrc();return this},upload:function(t){this.options.spinner&&e.cssLoader.show({urlPlugin:this.options.urlPlugin+"/getfile/libs",useLayer:!1,theme:"carousel"});var i=new FormData;if(this.options.multiple){var s=0;if(t.each(function(e){s+=e.size}),null!=this.options.maxFilesSizes&&0!=this.options.maxFilesSizes&&s>this.options.maxFilesSizes){this.options.spinner&&e.cssLoader.hide();var o=s/1048576,p=this.options.maxFilesSizes/1048576,n={success:!1,error:16,message:"The files whith weighing "+o.toFixed(2)+" Mb they does not been uploaded to the server, to exceed the maximum files sizes allowed of "+p.toFixed(2)+" Mb"};return this.callback(n),!1}var r=0,n=new Array;if(t.each(function(e){if(null!=this.options.maxFileSize&&0!=this.options.maxFileSize&&e.size>this.options.maxFileSize){var t=e.size/1048576,s=this.options.maxFileSize/1048576;n.push({success:!1,error:15,message:"The file "+e.name+" weighing "+t.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed of "+s.toFixed(2)+" Mb"})}else i.append("file"+r,e.nativeFile),r++}.bind(this)),!(r>0))return this.options.spinner&&e.cssLoader.hide(),n={success:!1,multiple:!0,files:n},this.callback(n),!1;n.length>0&&(this.properties.response=n),i.append("nFiles",r)}else{var l=t.first();if(null!=this.options.maxFileSize&&0!=this.options.maxFileSize&&l.size>this.options.maxFileSize||null!=this.options.maxFilesSizes&&0!=this.options.maxFilesSizes&&l.size>this.options.maxFilesSizes){this.options.spinner&&e.cssLoader.hide();var o=event.target.files[0].size/1048576,p=this.options.maxFileSize/1048576,n={success:!1,error:15,message:"The file "+event.target.files[0].name+" weighing "+o.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed of "+p.toFixed(2)+" Mb"};return this.callback(n),!1}i.append("file",l.nativeFile)}i.append("multiple",this.options.multiple),i.append("action","upload"),i.append("folder",this.options.folder),i.append("tmpFolder",this.options.tmpFolder),i.append("cropActive",this.options.crop.active),i.append("resizeActive",this.options.resize.active),i.append("outputExtension",this.options.outputExtension),i.append("encryption",this.options.encryption),i.append("filename",this.options.filename),i.append("mimesAccept",this.options.mimesAccept),i.append("activateTmpDelete",this.options.activateTmpDelete),i.append("tmpDelete",this.properties.tmpDelete),e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",data:i,type:"POST",dataType:"json",context:this,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&null!=this.callback){var t=e.loaded/e.total*100|0,i={success:!0,action:"loading",total:e.total,loaded:e.loaded,percentage:t};this.callback(i)}}.bind(this.context),!1),e},error:function(i){if(this.options.spinner&&e.cssLoader.hide(),this.options.multiple){var s=new Array,o=this;e.each(t,function(e,t){var p=t.size/1048576,n={success:!1,error:13,message:"The file "+t.name+" weighing "+p.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed to server: "+o.prototype.phpIni.postMaxSize,exception:i};s.push(n)}),this.callback(s)}else{var p=t.first(),n=p.size/1048576,s={success:!1,error:13,message:"The file "+p.name+" weighing "+n.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed to server:"+this.prototype.phpIni.postMaxSize,exception:i};this.callback(s)}},success:function(t){if(this.options.multiple?this.properties.files=t.files:(this.properties.tmpName=t.name,this.properties.size=t.size,this.properties.oldName=t.oldName,this.properties.extension=t.extension,this.properties.mime=t.mime,this.properties.isImage=t.isImage),this.options.crop.active&&t.isImage&&0==this.options.multiple){this.properties.width=t.width,this.properties.height=t.height,this.properties.pixelRatio=window.devicePixelRatio;var i=this;e("#cropper-modal").on("shown.bs.modal",function(){i.crop(i.options.tmpFolder+"/"+t.name)}),this.items.cropButton.off("click"),this.items.cropButton.on("click",e.proxy(this.executeCrop,this)),e("#cropper-modal").modal("show")}else if(this.options.resize.active&&t.isImage||this.options.resize.active&&1==this.options.multiple)if(this.options.multiple){for(var s=!1,o=0;o<this.properties.files.length;o++)1==this.properties.files[o].isImage&&(o=this.properties.files.length,s=!0,this.executeResize());s||null==this.callback||this.callback(t)}else this.executeResize();else if(null!=this.options.outputExtension&&t.isImage||null!=this.options.outputExtension&&1==this.options.multiple)if(this.options.multiple){for(var s=!1,o=0;o<this.properties.files.length;o++)1==this.properties.files[o].isImage&&(o=this.properties.files.length,s=!0,this.executeChangeExtension());s||null==this.callback||this.callback(t)}else this.executeChangeExtension();else if(this.options.copies.length>0&&t.isImage||this.options.copies.length>0&&1==this.options.multiple)if(this.options.multiple){for(var s=!1,o=0;o<this.properties.files.length;o++)1==this.properties.files[o].isImage&&(o=this.properties.files.length,s=!0,this.executeCopies(t));s||null==this.callback||this.callback(t)}else this.executeCopies(t);else null!=this.callback&&(this.options.multiple&&e.merge(t.files,n),this.callback(t));this.options.spinner&&e.cssLoader.hide()}})},loadSrc:function(){var t=this;this.options.tmpFolder=this.options.srcFolder,this.properties.src=this.options.tmpFolder+"/"+this.options.srcFile,e("#cropper-modal").on("shown.bs.modal",function(){t.crop(t.properties.src)}),e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",data:{action:"getinfosrc",src:t.properties.src},type:"POST",dataType:"json",context:this,cache:!1,success:function(t){this.properties.tmpName=t.oldName,this.properties.size=t.size,this.properties.oldName=t.oldName,this.properties.extension=t.extension,this.properties.mime=t.mime,this.properties.isImage=t.isImage,this.properties.width=t.width,this.properties.height=t.height,this.properties.pixelRatio=window.devicePixelRatio,this.items.cropButton.off("click"),this.items.cropButton.on("click",e.proxy(this.executeCrop,this)),e("#cropper-modal").modal("show")}})},crop:function(t){var i=this;if(!e.fn.cropper){var s={success:!1,error:3,message:"Cropper library not loaded"};null!=this.callback&&this.callback(s)}if(this.options.crop.height&&this.options.crop.width)this.options.crop.aspectRatio=this.options.crop.width/this.options.crop.height;else if(isNaN(this.options.crop.aspectRatio)){var s={success:!1,error:4,message:"Width and Height or Ratio must be defined"};null!=this.callback&&this.callback(s)}e(this.items.image).prop("src",t),this.items.image.data("cropper")?(e(this.items.image).cropper("destroy"),e(this.items.image).cropper({aspectRatio:this.options.crop.aspectRatio,preview:".img-preview",crop:function(){i.properties.coords=e(i.items.image).cropper("getData",!0)}})):e(this.items.image).cropper({aspectRatio:this.options.crop.aspectRatio,preview:".img-preview",crop:function(){i.properties.coords=e(i.items.image).cropper("getData",!0)}});var o=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./);o&&(this.properties.tmpNameIE11=this.properties.tmpName,this.properties.sizeIE11=this.properties.size,this.properties.oldNameIE11=this.properties.oldName,this.properties.extensionIE11=this.properties.extension,this.properties.mimeIE11=this.properties.mime,this.properties.isImageIE11=this.properties.isImage)},executeCrop:function(){e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:{action:"crop",tmpName:void 0==this.properties.tmpName?this.properties.tmpNameIE11:this.properties.tmpName,size:void 0==this.properties.size?this.properties.sizeIE11:this.properties.size,oldName:void 0==this.properties.oldName?this.properties.oldNameIE11:this.properties.oldName,extension:void 0==this.properties.extension?this.properties.extensionIE11:this.properties.extension,mime:void 0==this.properties.mime?this.properties.mimeIE11:this.properties.mime,isImage:void 0==this.properties.isImage?this.properties.isImageIE11:this.properties.isImage,coords:this.properties.coords,cropWidth:this.options.crop.width,cropHeight:this.options.crop.height,quality:this.options.crop.quality,aspectRatio:this.options.crop.aspectRatio,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,copies:this.options.copies},success:function(t){e("#cropper-modal").modal("hide"),null!=this.callback&&this.callback(t)},error:function(e){null!=this.callback&&this.callback(e.responseJSON)}})},showCropWindow:function(t){this.items.cropButton.off("click"),this.items.cropButton.on("click",e.proxy(this.executeCrop,this)),e("#cropper-modal").modal("show"),null!=t&&t({success:!0,action:"showCropWindow"})},executeResize:function(){if(this.options.multiple)var t={action:"resize",multiple:!0,files:this.properties.files,tmpFolder:this.options.tmpFolder,folder:this.options.folder,quality:this.options.resize.quality,width:this.options.resize.width,height:this.options.resize.height,constrainProportions:this.options.resize.constrainProportions,outputExtension:this.options.outputExtension,copies:this.options.copies};else var t={action:"resize",multiple:!1,tmpName:this.properties.tmpName,size:this.properties.size,oldName:this.properties.oldName,extension:this.properties.extension,mime:this.properties.mime,isImage:this.properties.isImage,tmpFolder:this.options.tmpFolder,folder:this.options.folder,quality:this.options.resize.quality,width:this.options.resize.width,height:this.options.resize.height,constrainProportions:this.options.resize.constrainProportions,outputExtension:this.options.outputExtension,copies:this.options.copies};e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:t,success:function(t){null!=this.callback&&(this.options.multiple&&null!=this.properties.response&&e.merge(t.files,this.properties.response),this.callback(t))},error:function(e){null!=this.callback&&this.callback(e.responseJSON)}})},executeChangeExtension:function(){if(this.options.multiple)var t={action:"change",multiple:!0,files:this.properties.files,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,quality:this.options.quality,copies:this.options.copies};else var t={action:"change",multiple:!1,tmpName:this.properties.tmpName,size:this.properties.size,oldName:this.properties.oldName,extension:this.properties.extension,mime:this.properties.mime,isImage:this.properties.isImage,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,quality:this.options.quality,copies:this.options.copies};e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:t,success:function(t){null!=this.callback&&(this.options.multiple&&null!=this.properties.response&&e.merge(t.files,this.properties.response),this.callback(t))},error:function(e){null!=this.callback&&this.callback(e.responseJSON)}})},executeCopies:function(t){this.options.multiple?(t.action="copies",t.multiple=!0,t.files=this.properties.files,t.folder=this.options.folder,t.copies=this.options.copies):(t.action="copies",t.multiple=!1,t.folder=this.options.folder,t.copies=this.options.copies),e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:t,success:function(t){null!=this.callback&&(this.options.multiple&&null!=this.properties.response&&e.merge(t.files,this.properties.response),this.callback(t))},error:function(e){null!=this.callback&&this.callback(e.responseJSON)}})},"delete":function(t,i){e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:{action:"delete",filenames:t},success:function(e){null!=i&&i(e)}})}};"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),e.fn.getFile=function(i,s){return t.hasOwnProperty("phpIni")||e.ajax({url:i.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:{action:"getvars"},success:function(e){t.phpIni=e}}),this.data("getFile")?this.data("getFile"):this.data("getFile",Object.create(t).init(i,s,this))},e.getFile=function(i,s){t.hasOwnProperty("phpIni")||e.ajax({url:i.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",context:this,cache:!1,data:{action:"getvars"},success:function(e){t.phpIni=e}}),e.data(document,"getFile",Object.create(t).init(i,s,null))}}(jQuery);
